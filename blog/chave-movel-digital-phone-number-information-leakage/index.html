<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Chave Móvel Digital Phone Number Leakage &#8211; The Codeumentary</title>
<meta name="description" content="Chave Móvel Digtial leaks registered phone numbers and e-mail addresses.">
<meta name="keywords" content="security">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://iluxonchik.github.io/images/">
<meta name="twitter:title" content="Chave Móvel Digital Phone Number Leakage">
<meta name="twitter:description" content="Chave Móvel Digtial leaks registered phone numbers and e-mail addresses.">
<meta name="twitter:creator" content="@iluxonchik">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Chave Móvel Digital Phone Number Leakage">
<meta property="og:description" content="Chave Móvel Digtial leaks registered phone numbers and e-mail addresses.">
<meta property="og:url" content="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/">
<meta property="og:site_name" content="The Codeumentary">





<link rel="canonical" href="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/">
<link href="https://iluxonchik.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="The Codeumentary Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://iluxonchik.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://iluxonchik.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://iluxonchik.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://iluxonchik.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://iluxonchik.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://iluxonchik.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://iluxonchik.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://iluxonchik.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://iluxonchik.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://iluxonchik.github.io/images/avatar.jpg" alt="Illya Gerasymchuk photo" class="author-photo">
					<h4>Illya Gerasymchuk</h4>
					<p>Software Engineer at Mercedes-Benz.io</p>
				</li>
				<li><a href="https://iluxonchik.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:illya@iluxonchik.me"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/iluxonchik"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/iluxonchik"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/iluxonchik"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="https://instagram.com/iluxonchik.meow"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://iluxonchik.github.io/posts/">All Posts</a></li>
				<li><a href="https://iluxonchik.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" rel="bookmark" title="Chave Móvel Digital Phone Number Leakage">Chave Móvel Digital Phone Number Leakage</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2018-05-13T17:00:02+01:00">May 13, 2018</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~3 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <ul>
  <li><a href="/weak-security-of-portuguese-government/">Part 1 - The Weak Security Of The Portuguese Government’s Authentication System</a></li>
  <li><a href="/chave-movel-digital-xss">Part 2 - Chave Móvel Digital Multiple XSS Vulnerabilites</a></li>
  <li><strong>Part 3 - Chave Móvel Digital Phone Number Leakage</strong></li>
  <li><a href="/chave-movel-digital-does-not-log-out">Part 4 - Chave Móvel Digital Log Out Not Working</a></li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>In this blog post I will be exploring the information leakage regarding
if a phone number is registered or not. The system has a protection
measure which can be easily bypassed. I will also provide proof-of-concept
code.</p>

<h1 id="determining-if-a-phone-number-is-registered-with-an-account">Determining If A Phone Number Is Registered With An Account</h1>

<p>If you enter a wrong phone number and PIN combination, you will be
presented with the following message:</p>

<style>

IMG.centered {
    display: block;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
}

</style>

<table>
    <caption align="bottom"><b>Figure 1:</b> The System Ties To Hide Information</caption>
    <tr><td style="max-width: 600px"><img class="centered" src="../images/posts/aut_gov_vuln/ambig_msg.png" alt="The System Ties To Hide Information" /></td></tr>
</table>

<p>The error message reads:</p>

<p><code class="highlighter-rouge">
O número de telemóvel ou o PIN estão errados ou registo inexistente
</code></p>

<p>Which translates to:</p>

<p><code class="highlighter-rouge">
Either the phone number or the PIN are incorrect or the account
is not registered.
</code></p>

<p>This might seem like a good thing: the system tries to give the
attacker the least information possible. The problem is that
this is useless, since it can be easily bypassed.</p>

<p>The issue is that if the phone number is registered, after <code class="highlighter-rouge">3</code> failed
attempts, your account will be temporary locked. If the phone number is not
registered, no lock in will occur.</p>

<style>

IMG.centered {
    display: block;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
}

</style>

<table>
    <caption align="bottom"><b>Figure 2:</b> Error Message When The Number Is Registered</caption>
    <tr><td style="max-width: 600px"><img class="centered" src="../images/posts/aut_gov_vuln/auth_err_msg.png" alt="Error Message When The Number Is Registered" /></td></tr>
</table>

<p>The good news is that if you enter the wrong <code class="highlighter-rouge">PIN</code> is entered again,
the temporary lockout period will be extended. Sometimes, you might be
asked to solve a captcha. My personal experience, however, suggests that
some simple machine learning can be used to bypass it. A better solution
here would be to use a more sophisticated solution, like Google’s <a href="https://www.google.com/recaptcha/intro/v3beta.html">ReCaptcha</a>.</p>

<style>

IMG.centered {
    display: block;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
}

</style>

<table>
    <caption align="bottom"><b>Figure 3:</b> A Simple Captcha Is Used</caption>
    <tr><td style="max-width: 600px"><img class="centered" src="../images/posts/aut_gov_vuln/simple_captcha.png" alt="A Simple Captcha Is Used" /></td></tr>
</table>

<p>Once you know that a phone number is registered in the system, you
could apply social engineering attacks to obtain access to the user’s account.
For example, in Portugal, you can send SMS messages with any Sender ID.
Services like <a href="https://aws.amazon.com/sns/pricing/">Amazon SNS</a> are cheap
and easy to use. When you receive your second-factor authentication code,
it comes from the sender <code class="highlighter-rouge">CMD</code> (it stands for <em>Chave Móvel Digital</em>, or
  Digital Mobile Key, in English). What an attacker could do is send the
user an SMS message with the sender id <code class="highlighter-rouge">CMD</code> saying that there is an issue
with the user’s account and that he needs to follow the provided link
to solve it. The link could perhaps exploit the <a href="https://iluxonchik.github.io/chave-movel-digital-xss/">XSS vulnerability described in the previous post</a>
to get the user’s PIN.</p>

<p>While not being a critical issue, it renders the existing protection system
useless. What they could instead do is treat all of the numbers the same:
lock the access to all of them, regardless of the fact if they are
registered or not. This should, however, be done with some care.
If you follow the naive approach of inserting every entered phone
number into the database and counting the number of login attempts,
the attacker might be able to flood the database with numbers. Careful
system design is needed here to prevent DoS attacks.</p>

<p>The same trick works with e-mail and Twitter authentication. These two
authentication methods are, however, not enabled by default.</p>

<h1 id="proof-of-concept">Proof-Of-Concept</h1>

<p>I wrote a simple <a href="https://github.com/iluxonchik/autenticacao-gov-pt-bruteforcer-pof">proof-of-concept code</a>.</p>

<p>A quick reverse-engineering of the authentication process showed that in order to access the login page, you need to go thought a specific sequence of steps, you can’t just go to the login page directly.</p>

<p>In that sequence of steps, your browser exchanges cookies with the server.
Among those, there are <code class="highlighter-rouge">3</code> different session ids that you get through this
process and a request that checks if your browser supports JavaScript.</p>

<p>With every <code class="highlighter-rouge">POST</code> request a <code class="highlighter-rouge">humanCheck</code> value is sent. This value is
set on document load:</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">'#humanCheck'</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="s1">'8FBB298A-DE46-4657-88E8-95F1F1224784'</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">"#inputMobile"</span><span class="p">).</span><span class="nx">intlTelInput</span><span class="p">();</span>
        <span class="p">});</span></code></pre></figure>

<p>I initially thought that that was a unique
value generated on every request, acting as a nonce. Further analysis
showed that this value is fixed. I’ve tried
with different IP’s, different browsers and the value remained the
same.</p>

<h1 id="conclusion">Conclusion</h1>

<p>As demonstrated in this blog post, while the system tries to be ambiguous by not
exposing if the phone number is registered with an account or not, it can be
easily bypassed.</p>

<p>In the <a href="/chave-movel-digital-does-not-log-out">next and final blog post of this series</a> I will explore another issue: the fact
that the “Log Out” button does not actually log you out.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="https://iluxonchik.github.io/tags/#security" title="Pages tagged security" class="tag"><span class="term">security</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

       <!-- Social Profile Buttons -->
       
           <a class="github-button" href="https://github.com/iluxonchik" data-style="mega" aria-label="Follow @iluxonchik on GitHub">Follow @iluxonchik</a>
       

       
            <a href="https://twitter.com/iluxonchik" class="twitter-follow-button" data-size="large" data-show-count="false">Follow @iluxonchik</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
       


       
        <a href="http://instagram.com/iluxonchik.meow" title="Illya Gerasymchuk on Instagram" target="_blank">
          <i class="fa fa-instagram" style="font-size:29px;color:black;"></i>
        <span style="color:black;">Instagram</span></a>
       
      <!-- //Social Profile Buttons -->

      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="https://iluxonchik.github.io/chave-movel-digital-xss/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/" title="Chave Móvel Digital's Log Out Button Does Not Log The User Out">Chave Móvel Digital's Log Out Button Does Not Log The User Out</a></h3>
      <p>The Log Out button in the Portuguese government's authentication system does not log the user out. This opens a window to unauthorized account access. <a href="https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="https://iluxonchik.github.io/chave-movel-digital-xss/" title="Chave Móvel Digital Multiple XSS Vulnerabilities">Chave Móvel Digital Multiple XSS Vulnerabilities</a></h4>
        <span>Published on May 13, 2018</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="https://iluxonchik.github.io/weak-security-of-portuguese-government/" title="The Weak Security Of The Portuguese Government's Authentication System">The Weak Security Of The Portuguese Government's Authentication System</a></h4>
        <span>Published on May 13, 2018</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 Illya Gerasymchuk. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://iluxonchik.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://iluxonchik.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83065535-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iluxonchik'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    <!-- Social Profile Buttons GitHub -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- //Social Profile Buttons GitHub -->


</body>
</html>
