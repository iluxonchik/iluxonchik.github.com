<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Chave Móvel Digital's Log Out Button Does Not Log The User Out &#8211; The Codeumentary</title>
<meta name="description" content="The Log Out button in the Portuguese government's authentication system does not log the user out. This opens a window to unauthorized account access.">
<meta name="keywords" content="security">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://iluxonchik.github.io/images/">
<meta name="twitter:title" content="Chave Móvel Digital's Log Out Button Does Not Log The User Out">
<meta name="twitter:description" content="The Log Out button in the Portuguese government's authentication system does not log the user out. This opens a window to unauthorized account access.">
<meta name="twitter:creator" content="@iluxonchik">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Chave Móvel Digital's Log Out Button Does Not Log The User Out">
<meta property="og:description" content="The Log Out button in the Portuguese government's authentication system does not log the user out. This opens a window to unauthorized account access.">
<meta property="og:url" content="https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/">
<meta property="og:site_name" content="The Codeumentary">





<link rel="canonical" href="https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/">
<link href="https://iluxonchik.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="The Codeumentary Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://iluxonchik.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://iluxonchik.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://iluxonchik.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://iluxonchik.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://iluxonchik.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://iluxonchik.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://iluxonchik.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://iluxonchik.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://iluxonchik.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://iluxonchik.github.io/images/avatar.jpg" alt="Illya Gerasymchuk photo" class="author-photo">
					<h4>Illya Gerasymchuk</h4>
					<p>Software Engineer at Mercedes-Benz.io</p>
				</li>
				<li><a href="https://iluxonchik.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:illya@iluxonchik.me"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/iluxonchik"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/iluxonchik"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/iluxonchik"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				<li>
					<a href="https://instagram.com/iluxonchik.meow"><i class="fa fa-fw fa-instagram"></i> Instagram</a>
				</li>
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://iluxonchik.github.io/posts/">All Posts</a></li>
				<li><a href="https://iluxonchik.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/" rel="bookmark" title="Chave Móvel Digital's Log Out Button Does Not Log The User Out">Chave Móvel Digital's Log Out Button Does Not Log The User Out</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2018-05-13T17:00:03+01:00">May 13, 2018</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~2 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <ul>
  <li><a href="/weak-security-of-portuguese-government/">Part 1 - The Weak Security Of The Portuguese Government’s Authentication System</a></li>
  <li><a href="/chave-movel-digital-xss">Part 2 - Chave Móvel Digital Multiple XSS Vulnerabilites</a></li>
  <li><a href="/chave-movel-digital-phone-number-information-leakage">Part 3 - Chave Móvel Digital Phone Number Leakage</a></li>
  <li><strong>Part 4 - Chave Móvel Digital Log Out Not Working</strong></li>
</ul>

<h1 id="introduction">Introduction</h1>

<p>In this blog post I will show you that the “Log Out” button does
not actually log the user out.</p>

<h1 id="the-log-out-button-does-not-log-you-out">The Log Out Button Does Not Log You Out</h1>

<p>If you click on “Sair”, which translates to “Log Out” you’re not
actually logged out. It doesn’t matter if you try to login straight away,
try to login in a new tab or try to login in a new window. The only
way to actually log out is to close the browser and open it again.</p>

<p>The video below demonstrates the issue in action.</p>

<iframe width="560" height="315" src="https://www.youtube.com/embed/f5I1wwP0_UM" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>

<p>I’ve tested this in Google Chrome on Android and the problem was present
there too. This is an issue. Let’s say that the user logs on a device that’s
not his. After he’s finished with his tasks he clicks on “Log Out”,
thinking that his session has been terminated. This means that the
attacker can simply open the website, click on “Log In” and
obtain access to the victim’s account.</p>

<p>A little bit of exploring reveled the problem. The only think that
clicking “Log Out” does is redirecting the user’s browser to
<code class="highlighter-rouge">https://www.autenticacao.gov.pt/c/portal/logout</code>. This page, in turn,
redirects the user back to the home page and sets some
cookies to an empty string, namely <code class="highlighter-rouge">COMPANY_ID</code>, <code class="highlighter-rouge">ID</code>, <code class="highlighter-rouge">LOGIN</code>, <code class="highlighter-rouge">PASSWORD</code> and
<code class="highlighter-rouge">REMEMBER ME</code>. I’m not sure what they are, since I haven’t seen them
used anywhere else on the site. I assume it’s some code that was ported
for somewhere, but was never adjusted to a different authentication
mechanism (I just hope they weren’t storing the password in plain text
there).</p>

<style>

IMG.centered {
    display: block;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
}

</style>

<table>
    <caption align="bottom"><b>Figure 1:</b> Cookies Set By The Log Out Page</caption>
    <tr><td style="max-width: 600px"><img class="centered" src="../images/posts/aut_gov_vuln/logout_cookies.png" alt="Cookies Set By The Log Out Page" /></td></tr>
</table>

<p>What the page fails to do, is clean the <code class="highlighter-rouge">ASPXAUTH</code> and <code class="highlighter-rouge">ASP.Net_SessionId</code>
cookies. In <code class="highlighter-rouge">ASP.NET</code> <code class="highlighter-rouge">ASPXAUTH</code> is a cookie used to identity if the user is
authenticated and the <code class="highlighter-rouge">ASP.Net_SessionId</code> is a cookie used to identify the
user’s session on the server.</p>

<p>Those cookie’s expiration date is not set, which means that they will have
the life time of a session cookie,  meaning that they will get removed once
the client is shut down. This explains why closing and opening the browser
again actually logs the user out.</p>

<p>The solution to this problem is to simply clear the <code class="highlighter-rouge">ASPXAUTH</code> and <code class="highlighter-rouge">ASP.Net_SessionId</code> on the log out page.</p>

<h1 id="conclusion">Conclusion</h1>

<p>In this blog post I demonstrated that the “Log Out” button does not actually
log the user out, since it fails to clean the authentication cookie.
This opens a window to unauthorized account access.</p>

<p>This blog post ends the series of blog posts related to the security
weaknesses and vulnerabilities found in the Portuguese government’s
authentication system <code class="highlighter-rouge">autenticacao.gov.pt</code> and <em>Chave Móvel Digital</em>.
The issues described throughout these blog posts were not a result of a
thorough analysis, but rather what I found in about 30 minutes.
This leads me to believe that a more detailed study of the system’s
security is likely to reveal many more problems.</p>

<p>I hope that the described issues will be fixed very soon,
since they put millions of Portuguese citizens at risk. The agency
responsible for these systems should take security more seriously
and not as an afterthought.</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="https://iluxonchik.github.io/tags/#security" title="Pages tagged security" class="tag"><span class="term">security</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=https://iluxonchik.github.io/chave-movel-digital-does-not-log-out/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->

       <!-- Social Profile Buttons -->
       
           <a class="github-button" href="https://github.com/iluxonchik" data-style="mega" aria-label="Follow @iluxonchik on GitHub">Follow @iluxonchik</a>
       

       
            <a href="https://twitter.com/iluxonchik" class="twitter-follow-button" data-size="large" data-show-count="false">Follow @iluxonchik</a><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
       


       
        <a href="http://instagram.com/iluxonchik.meow" title="Illya Gerasymchuk on Instagram" target="_blank">
          <i class="fa fa-instagram" style="font-size:29px;color:black;"></i>
        <span style="color:black;">Instagram</span></a>
       
      <!-- //Social Profile Buttons -->

      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/" title="Chave Móvel Digital Phone Number Leakage">Chave Móvel Digital Phone Number Leakage</a></h3>
      <p>Chave Móvel Digtial leaks registered phone numbers and e-mail addresses. <a href="https://iluxonchik.github.io/chave-movel-digital-phone-number-information-leakage/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="https://iluxonchik.github.io/chave-movel-digital-xss/" title="Chave Móvel Digital Multiple XSS Vulnerabilities">Chave Móvel Digital Multiple XSS Vulnerabilities</a></h4>
        <span>Published on May 13, 2018</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="https://iluxonchik.github.io/weak-security-of-portuguese-government/" title="The Weak Security Of The Portuguese Government's Authentication System">The Weak Security Of The Portuguese Government's Authentication System</a></h4>
        <span>Published on May 13, 2018</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 Illya Gerasymchuk. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://iluxonchik.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://iluxonchik.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-83065535-1', 'auto');  
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>



    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'iluxonchik'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



    <!-- Social Profile Buttons GitHub -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- //Social Profile Buttons GitHub -->


</body>
</html>
